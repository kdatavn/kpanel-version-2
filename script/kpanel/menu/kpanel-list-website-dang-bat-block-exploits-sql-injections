#!/bin/bash
. /home/kpanel.conf
echo "-------------------------------------------------------------------------"
echo "Please wait ..."
sleep 1
rm -rf /tmp/*kdatavn*
mkdir -p /tmp/sitedangbatsqlinjectkdatavn
ls /etc/nginx/conf.d > /tmp/kpanel-websitelist
sed -i 's/\.conf//g' /tmp/kpanel-websitelist 
sowebsitetrenserver=$(cat /tmp/kpanel-websitelist | wc -l)
sowebsite=$(cat /tmp/kpanel-websitelist)
for website in $sowebsite 
do
if [ -f /etc/nginx/conf.d/$website.conf ]; then
if [ "$(grep block.conf /etc/nginx/conf.d/$website.conf)" == "include /etc/nginx/conf/block.conf;" ]; then
touch /tmp/sitedangbatsqlinjectkdatavn/$website
fi
fi
if [ -f /etc/nginx/conf.d/www.$website.conf ]; then
if [ "$(grep block.conf /etc/nginx/conf.d/www.$website.conf)" == "include /etc/nginx/conf/block.conf;" ]; then
touch /tmp/sitedangbatsqlinjectkdatavn/www.$website
fi
fi
done
clear
echo "========================================================================="
echo "Website on server: $sowebsitetrenserver"
echo "-------------------------------------------------------------------------"
if [ "$(ls -1 /tmp/sitedangbatsqlinjectkdatavn | wc -l)" == "0" ]; then
echo "Website ENABLED [Block Exploits, SQL Injections]: 0"
else
echo "Website ENABLED [Block Exploits, SQL Injections]: $(ls -1 /tmp/sitedangbatsqlinjectkdatavn | wc -l)"
echo "-------------------------------------------------------------------------"
ls /tmp/sitedangbatsqlinjectkdatavn | pr -3 -t
fi
/etc/kpanel/menu/tienich/kpanel-tien-ich
